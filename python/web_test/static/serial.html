<!DOCTYPE html>
<html>
<head>
    <title>Serial Terminal</title>
    <style>
        #output {
            width: 100%;
            height: 400px;
            background: #000;
            color: #33ff33;
            font-family: 'Courier New', monospace;
            padding: 10px;
            overflow-y: scroll;
            white-space: pre;
            margin-bottom: 10px;
            font-size: 14px;
        }
        #command {
            width: 80%;
            padding: 5px;
            font-family: 'Courier New', monospace;
            background: #222;
            color: #fff;
            border: 1px solid #444;
        }
        #send {
            width: 18%;
            padding: 5px;
        }
        .controls {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div id="output"></div>
    <div class="controls">
        <input type="text" id="command" placeholder="Enter serial command...">
        <button id="send">Send</button>
    </div>

    <script>
        const output = document.getElementById('output');
        const command = document.getElementById('command');
        const send = document.getElementById('send');
        const ws = new WebSocket(`ws://${window.location.host}/ws/serial`);  // Updated WebSocket endpoint

        function appendToTerminal(data, isTx = false) {
            const line = isTx ? `TX: ${data}\n` : `${data}\n`;
            output.textContent += line;
            output.scrollTop = output.scrollHeight;
        }

        ws.onopen = () => appendToTerminal('Connected to serial port');
        
        ws.onmessage = (event) => {
            try {
                const data = event.data;
                // Assuming raw string data from serial port
                appendToTerminal(data);
            } catch (e) {
                appendToTerminal(`Error: ${e.message}`);
            }
        };

        ws.onerror = (error) => appendToTerminal(`WebSocket Error: ${error.message}`);
        ws.onclose = () => appendToTerminal('Connection closed');

        function sendCommand() {
            if (ws.readyState === WebSocket.OPEN) {
                const cmd = command.value;
                if (cmd) {
                    ws.send(cmd);
                    appendToTerminal(cmd, true);
                    command.value = '';
                }
            } else {
                appendToTerminal('Error: WebSocket not connected');
            }
        }

        send.onclick = sendCommand;
        command.onkeypress = (e) => {
            if (e.key === 'Enter') {
                sendCommand();
            }
        };
    </script>
</body>
</html>
