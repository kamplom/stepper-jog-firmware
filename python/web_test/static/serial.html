<!DOCTYPE html>
<html>
<head>
    <title>Serial Monitor</title>
    <style>
        #output {
            width: 100%;
            height: 400px;
            background: #1e1e1e;
            color: #00ff00;
            font-family: monospace;
            padding: 10px;
            overflow-y: scroll;
            white-space: pre-wrap;
            margin-bottom: 10px;
        }
        #command {
            width: 80%;
            padding: 5px;
            font-family: monospace;
        }
        #send {
            width: 18%;
            padding: 5px;
        }
        .controls {
            display: flex;
            gap: 10px;
        }
        .timestamp {
            color: #888;
        }
    </style>
</head>
<body>
    <div id="output"></div>
    <div class="controls">
        <input type="text" id="command" placeholder="Enter command...">
        <button id="send">Send</button>
    </div>

    <script>
        const output = document.getElementById('output');
        const command = document.getElementById('command');
        const send = document.getElementById('send');
        const ws = new WebSocket(`ws://${window.location.host}/ws`);

        function getTimestamp() {
            const now = new Date();
            return `[${now.toLocaleTimeString('en-US', { hour12: false })}]`;
        }

        function appendMessage(msg, incoming = true) {
            const timestamp = getTimestamp();
            const direction = incoming ? "<<< " : ">>> ";
            output.insertAdjacentHTML('beforeend', 
                `<span class="timestamp">${timestamp}</span> ${direction}${msg}\n`);
            output.scrollTop = output.scrollHeight;
        }

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            appendMessage(JSON.stringify(data));
        };

        ws.onclose = function() {
            appendMessage("WebSocket connection closed");
        };

        function sendCommand() {
            const cmd = command.value;
            if (cmd) {
                ws.send(cmd);
                appendMessage(cmd, false);
                command.value = '';
            }
        }

        send.onclick = sendCommand;
        command.onkeypress = function(e) {
            if (e.key === 'Enter') {
                sendCommand();
            }
        };
    </script>
</body>
</html>
